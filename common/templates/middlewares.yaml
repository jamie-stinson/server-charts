{{- if .Values.ingress.traefik.enabled }}
  {{- range .Values.ingress.traefik.hosts }}
    {{- $middlewareName := printf "%s-%s-middleware" $.Release.Name .name }}

    apiVersion: traefik.containo.us/v1alpha1
    kind: Middleware
    metadata:
      name: {{ $middlewareName }}
    spec:
      headers:
        {{- if .cors.enabled }}
        accessControlAllowMethods:
          {{- range .cors.accessControlAllowMethods }}
          - "{{ . }}"
          {{- end }}
        accessControlAllowHeaders:
          {{- range .cors.accessControlAllowHeaders }}
          - "{{ . }}"
          {{- end }}
        accessControlAllowOriginList:
          {{- range .cors.accessControlAllowOriginList }}
          - "{{ . }}"
          {{- end }}
        accessControlMaxAge: {{ .cors.accessControlMaxAge }}
        addVaryHeader: {{ .cors.addVaryHeader }}
        {{- end }}
        {{- if .customRequestHeaders }}
        customRequestHeaders:
          {{- range $key, $value := .customRequestHeaders }}
          {{ $key }}: "{{ $value }}"
          {{- end }}
        {{- end }}
        {{- if .customResponseHeaders }}
        customResponseHeaders:
          {{- range $key, $value := .customResponseHeaders }}
          {{ $key }}: "{{ $value }}"
          {{- end }}
        {{- end }}
  {{- end }}
{{- end }}